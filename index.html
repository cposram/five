<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å°ˆæ¥­äº”å­æ£‹å°æˆ° - æ·é‹å’–å•¡é¢¨</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-bundle.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-bundle.js"></script>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background: #f4f1ea; }
        #menu { margin: 20px; padding: 20px; border: 2px solid #6f4e37; border-radius: 10px; background: white; }
        #board { display: grid; grid-template-columns: repeat(15, 30px); grid-template-rows: repeat(15, 30px); background: #e3c16f; border: 2px solid #8b4513; cursor: pointer; position: relative; }
        .cell { width: 30px; height: 30px; border: 0.5px solid #8b4513; box-sizing: border-box; display: flex; justify-content: center; align-items: center; }
        .black { width: 24px; height: 24px; background: black; border-radius: 50%; box-shadow: 2px 2px 5px rgba(0,0,0,0.5); }
        .white { width: 24px; height: 24px; background: white; border-radius: 50%; box-shadow: 2px 2px 5px rgba(0,0,0,0.3); }
        #leaderboard { position: absolute; right: 20px; top: 20px; background: rgba(111, 78, 55, 0.1); padding: 10px; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #6f4e37; color: white; border: none; border-radius: 5px; }
    </style>
</head>
<body>

<div id="leaderboard">
    <h3>ğŸ† å‰ä¸‰åæ’è¡Œæ¦œ</h3>
    <ol id="rank-list"><li>è¼‰å…¥ä¸­...</li></ol>
</div>

<div id="menu">
    <h2>é¸æ“‡ NPC é›£åº¦é€²å…¥éŠæˆ²</h2>
    <button onclick="startGame('easy')">åˆç´š (éš¨æ©Ÿ)</button>
    <button onclick="startGame('medium')">ä¸­ç´š (é˜²å®ˆå‹)</button>
    <button onclick="startGame('hard')">é«˜ç´š (é€²æ”»å‹)</button>
</div>

<div id="game-info" style="display:none;">
    <p>ç›®å‰æ­¥æ•¸: <span id="step-count">0</span> | é›£åº¦: <span id="current-lv"></span></p>
    <div id="board"></div>
</div>

<script>
// --- Firebase è¨­å®š (è«‹å¡«å…¥æ‚¨åŸæœ¬çš„ API Key) ---
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    databaseURL: "YOUR_DATABASE_URL",
    projectId: "YOUR_PROJECT_ID"
};
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let board = [];
let steps = 0;
let difficulty = 'easy';
let gameOver = false;

// åˆå§‹åŒ–æ£‹ç›¤
function createBoard() {
    const boardEl = document.getElementById('board');
    boardEl.innerHTML = '';
    board = Array(15).fill().map(() => Array(15).fill(0));
    for (let r = 0; r < 15; r++) {
        for (let c = 0; c < 15; c++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.onclick = () => playerMove(r, c);
            boardEl.appendChild(cell);
        }
    }
}

function startGame(lv) {
    difficulty = lv;
    steps = 0;
    gameOver = false;
    document.getElementById('menu').style.display = 'none';
    document.getElementById('game-info').style.display = 'block';
    document.getElementById('current-lv').innerText = lv.toUpperCase();
    document.getElementById('step-count').innerText = "0";
    createBoard();
    updateLeaderboard();
}

function playerMove(r, c) {
    if (board[r][c] !== 0 || gameOver) return;
    makeMove(r, c, 1); // 1 ç‚ºç©å®¶(é»‘)
    steps++;
    document.getElementById('step-count').innerText = steps;
    
    if (checkWin(r, c, 1)) {
        alert("æ­å–œå‹åˆ©ï¼ç¸½æ­¥æ•¸ï¼š" + steps);
        saveScore(steps);
        gameOver = true;
        return;
    }
    
    setTimeout(npcMove, 500);
}

function npcMove() {
    if (gameOver) return;
    let r, c;
    if (difficulty === 'easy') {
        do { r = Math.floor(Math.random()*15); c = Math.floor(Math.random()*15); } while (board[r][c] !== 0);
    } else {
        // ä¸­é«˜ç´šç°¡åŒ–é‚è¼¯ï¼šå„ªå…ˆé˜»æ“‹ç©å®¶é€£å››ï¼Œå¦å‰‡éš¨æ©Ÿ
        const best = findBestMove();
        r = best.r; c = best.c;
    }
    
    makeMove(r, c, 2); // 2 ç‚º NPC(ç™½)
    if (checkWin(r, c, 2)) {
        alert("NPC ç²å‹ï¼å†æ¥å†å²ã€‚");
        gameOver = true;
    }
}

function makeMove(r, c, p) {
    board[r][c] = p;
    const index = r * 15 + c;
    const cell = document.getElementsByClassName('cell')[index];
    const piece = document.createElement('div');
    piece.className = p === 1 ? 'black' : 'white';
    cell.appendChild(piece);
}

function checkWin(r, c, p) {
    const directions = [[1,0],[0,1],[1,1],[1,-1]];
    for (let [dr, dc] of directions) {
        let count = 1;
        for (let i=1; i<5; i++) {
            if (board[r+dr*i]?.[c+dc*i] === p) count++; else break;
        }
        for (let i=1; i<5; i++) {
            if (board[r-dr*i]?.[c-dc*i] === p) count++; else break;
        }
        if (count >= 5) return true;
    }
    return false;
}

// ç°¡æ˜“ AI æœå°‹ (ä¸­/é«˜ç´šé€šç”¨é‚è¼¯)
function findBestMove() {
    // å„ªå…ˆæ“‹æ‰ç©å®¶å³å°‡å‹åˆ©çš„é»
    for (let r=0; r<15; r++) {
        for (let c=0; c<15; c++) {
            if (board[r][c] === 0) {
                if (checkWin(r, c, 1)) return {r, c};
            }
        }
    }
    // å¦å‰‡æ‰¾ä¸­é–“å€åŸŸéš¨æ©Ÿè½å­
    let r, c;
    do { r = Math.floor(Math.random()*15); c = Math.floor(Math.random()*15); } while (board[r][c] !== 0);
    return {r, c};
}

function saveScore(s) {
    const name = prompt("é€²å…¥å‰ä¸‰åï¼è«‹ç•™å:") || "ç¥ç§˜é«˜æ‰‹";
    db.ref('gomoku_leaderboard').push({ name, steps: s, date: Date.now() });
}

function updateLeaderboard() {
    db.ref('gomoku_leaderboard').orderByChild('steps').limitToFirst(3).on('value', (snapshot) => {
        const listEl = document.getElementById('rank-list');
        listEl.innerHTML = '';
        snapshot.forEach((child) => {
            const data = child.val();
            listEl.innerHTML += `<li>${data.name}: ${data.steps} æ­¥</li>`;
        });
    });
}
</script>
</body>
</html>

